# Snake Game 新功能说明

## 概览

本次更新为Snake游戏添加了以下功能，大幅提升了游戏的**模块化**、**视觉体验**、**音效**和**儿童友好性**。

---

## 🎨 一、主题系统

### 功能描述
支持4种不同风格的主题，满足不同年龄和审美偏好。

### 可用主题

| 主题名称 | 适合人群 | 配色特点 |
|---------|---------|---------|
| **Dark Tech** (默认) | 成人/极客 | 深蓝背景 + 青色发光 |
| **Kids Bright** | 儿童 | 浅米色背景 + 草绿蛇 + 粉色点缀 |
| **Ocean** | 所有人 | 海洋蓝 + 金色食物 + 青绿蛇 |
| **Candy** | 儿童/少女 | 薰衣草色 + 紫色蛇 + 粉色食物 |

### 使用方法
- **按 `T` 键**：循环切换主题（菜单和游戏中都可用）
- 主题切换立即生效，背景、网格、边框都会更新

### 技术实现
- 文件：[src/config/themes.py](src/config/themes.py)
- 使用 `ThemeManager` 管理主题切换
- 背景渐变使用主题的 `background_primary` 和 `background_secondary`

---

## ⚙️ 二、难度系统

### 功能描述
3种难度级别，调整游戏速度、规则和奖励。

### 难度对比

| 难度 | 初速度 | 最高速 | 炸弹 | 穿墙 | 分数倍率 | 适合 |
|------|--------|--------|------|------|---------|------|
| **Easy** | 6 FPS | 15 FPS | ❌ | ✅ | 0.5x | 儿童/新手 |
| **Medium** | 10 FPS | 25 FPS | ✅ | ❌ | 1.0x | 普通玩家 |
| **Hard** | 15 FPS | 35 FPS | ✅ | ❌ | 2.0x | 高手 |

### 核心特性

#### Easy 模式特点
- **穿墙功能**：蛇撞墙时会从对面出现，不会死亡
- **无炸弹干扰**：专注于吃食物
- **速度缓慢**：更容易控制
- **分数减半**：降低竞争压力

#### Hard 模式特点
- **高速挑战**：最高速度达到 35 FPS
- **分数翻倍**：每个食物20分
- **炸弹威胁**：需要躲避爆炸

### 使用方法
- **按 `D` 键**（仅在主菜单）：循环切换难度
- 主菜单显示当前难度
- 游戏开始后难度固定，需重新开始才能更改

### 技术实现
- 文件：[src/core/difficulty.py](src/core/difficulty.py)
- `DifficultyManager` 管理当前难度
- `wall_wrap_around` 控制穿墙行为（修改了 [snake.py:103-121](src/game/snake.py#L103-L121)）

---

## 😊 三、蛇的表情系统

### 功能描述
蛇的眼睛会根据游戏状态显示不同表情，增加趣味性。

### 表情类型

| 表情 | 触发条件 | 眼睛形状 | 持续时间 |
|------|---------|---------|---------|
| **Normal** | 默认状态 | 普通圆点眼 | - |
| **Happy** | 吃到食物 | 弯弯眼 (^_^) | 30帧 (0.5秒) |
| **Excited** | 连续吃3个食物 | ⭐星星眼 | 40帧 (0.7秒) |
| **Worried** | 接近危险（预留） | 惊恐大眼 | 动态 |

### 连击系统
- 连续吃食物时 combo 计数增加
- 2秒内不吃食物，combo 重置
- 达到3连击时触发 Excited 表情

### 技术实现
- 文件：[src/game/snake.py](src/game/snake.py)
- 新增 `SnakeExpression` 类（17-22行）
- 新增 `set_expression()`, `update_expression()` 方法
- `_draw_eyes()` 方法根据表情绘制不同眼睛（147-175行）
- `_draw_star()` 方法绘制星星形状（177-187行）

---

## 🎁 四、道具系统

### 功能描述
游戏中随机生成3种道具，提供临时能力增强。

### 道具类型

| 道具 | 颜色 | 图标 | 效果 | 持续时间 | 生成周期 |
|------|------|------|------|---------|---------|
| **Slow Potion** | 🔵 蓝色 | 药瓶 | 速度 -5 | 5秒 | 每15秒 |
| **Shield** | 🟡 金色 | 盾牌 | 免死一次 | 3秒 | 随机生成 |
| **Double Score** | 🩷 粉色 | x2 | 分数翻倍 | 8秒 | 随机生成 |

### 视觉效果
- **脉冲动画**：道具大小周期性变化
- **光晕效果**：半透明发光外圈
- **10秒消失**：未吃到的道具会消失

### 使用方法
- 吃道具的蛇头碰到道具即可自动激活
- 屏幕左侧显示当前激活的道具和剩余时间
- 多个道具可同时激活

### 技术实现
- 文件：[src/game/powerups.py](src/game/powerups.py)
- `PowerUp` 基类定义道具行为
- `PowerUpManager` 管理生成和效果
- 集成到 [game.py:272-289](src/game/game.py#L272-L289)

---

## ✨ 五、得分浮动文字

### 功能描述
吃到食物时，分数以动画形式从食物位置浮现。

### 视觉效果
- **上浮动画**：文字向上漂浮
- **渐隐效果**：透明度逐渐降低
- **缩放动画**：略微放大后缩小
- **颜色分级**：
  - 🤍 白色：基础分数 (+10)
  - 💚 绿色：中等分数 (+20)
  - 🏆 金色大字：高分 (+50!)

### 得分计算
分数 = 基础分 × 道具倍率 × 难度倍率

示例：
- Easy + 双倍道具：10 × 2.0 × 0.5 = **10分**
- Hard + 双倍道具：10 × 2.0 × 2.0 = **40分**

### 技术实现
- 文件：[src/effects/floating_text.py](src/effects/floating_text.py)
- `FloatingText` 类管理单个文字动画
- `FloatingTextManager` 管理所有浮动文字
- 集成到 [game.py:301-307](src/game/game.py#L301-L307)

---

## 🛡️ 六、保护盾机制

### 功能描述
吃到盾牌道具后，下一次碰撞不会死亡。

### 工作原理
1. 吃到金色盾牌道具
2. 屏幕左侧显示 "Shield: X.Xs"
3. 撞墙或撞自己时：
   - **有盾**：盾消失，显示 "Shield Saved You!" 继续游戏
   - **无盾**：正常游戏结束

### 技术实现
- 在 [game.py:245-255](src/game/game.py#L245-L255) 检测碰撞时判断 `shield_active`
- 盾牌激活时显示浮动文字提示

---

## 🎮 控制说明

### 主菜单
| 按键 | 功能 |
|------|------|
| `Space` | 开始游戏 |
| `T` | 切换主题 |
| `D` | 切换难度 |
| `M` | 开/关音乐 |
| `N` | 切换音乐风格 |
| `F` | 全屏/窗口 |
| `Q` | 退出游戏 |

### 游戏中
| 按键 | 功能 |
|------|------|
| `↑↓←→` | 控制蛇移动 |
| `P` | 暂停/继续 |
| `T` | 切换主题 |
| `B` | 放置炸弹（如果可用） |
| `M` | 开/关音乐 |
| `N` | 切换音乐风格 |
| `F` | 全屏/窗口 |

### 游戏结束
| 按键 | 功能 |
|------|------|
| `R` | 重新开始 |
| `Q` | 退出游戏 |

---

## 📂 新增文件结构

```
src/
├── config/
│   └── themes.py              # 主题系统（新增）
├── core/                      # 核心系统（新增目录）
│   ├── __init__.py
│   └── difficulty.py          # 难度系统
├── effects/                   # 视觉效果（新增目录）
│   ├── __init__.py
│   └── floating_text.py       # 浮动文字
└── game/
    ├── powerups.py            # 道具系统（新增）
    ├── snake.py               # 蛇（修改：表情+穿墙）
    └── game.py                # 主游戏（修改：集成所有新功能）

test_features.py               # 功能测试脚本（新增）
FEATURES.md                    # 本文档（新增）
```

---

## 🧪 测试

运行测试脚本验证所有功能：

```bash
python3 test_features.py
```

**预期输出**：
```
✓ ALL TESTS PASSED!

New Features Summary:
  • 4 Themes (Dark Tech, Kids Bright, Ocean, Candy)
  • 3 Difficulty Levels (Easy/Medium/Hard)
  • Snake Expressions (Normal, Happy, Excited, Worried)
  • Wall Wrapping (Easy mode)
  • 3 Power-ups (Slow Potion, Shield, Double Score)
  • Floating Score Text
```

---

## 🎯 儿童友好性改进总结

### 视觉改进
✅ **亮色主题**：Kids Bright 和 Candy 主题使用柔和明亮的颜色
✅ **可爱表情**：星星眼、弯弯眼增加趣味性
✅ **浮动文字**：直观的分数反馈
✅ **彩色道具**：视觉吸引力强

### 难度改进
✅ **Easy 模式**：穿墙功能降低死亡率
✅ **无炸弹**：减少挫败感
✅ **慢速**：易于控制
✅ **保护盾**：给予第二次机会

### 音效改进（预留）
🔜 Kids 音乐风格（计划中）
🔜 成就音效（计划中）

---

## 🚀 运行游戏

```bash
cd /Users/sckicker/Documents/jeff-snake-game
python3 main.py
```

### 推荐给儿童的配置
1. 按 `D` 选择 **Easy** 难度
2. 按 `T` 选择 **Kids Bright** 或 **Candy** 主题
3. 按 `Space` 开始游戏

---

## 📊 功能对比表

| 功能 | 改进前 | 改进后 |
|------|--------|--------|
| 主题 | 1种（深色） | 4种（含儿童主题） |
| 难度 | 固定 | 3档可选 |
| 蛇表情 | 固定眼睛 | 4种动态表情 |
| 穿墙 | ❌ | ✅（Easy模式） |
| 道具 | 仅炸弹 | 3种增益道具 |
| 得分反馈 | 静态文字 | 动画浮动文字 |
| 保护机制 | ❌ | ✅（盾牌道具） |
| 连击系统 | ❌ | ✅（3连激活表情） |

---

## 🎓 技术亮点

1. **模块化设计**：新功能独立为模块（themes, difficulty, powerups）
2. **单一职责**：每个管理器只负责一个功能
3. **易扩展**：添加新主题/道具/难度只需修改配置
4. **向后兼容**：保留所有原有功能和控制
5. **无外部依赖**：使用 Pygame 内置功能实现所有效果

---

## 📝 后续优化建议

### 高优先级
- [ ] 成就系统（已设计，见计划文档）
- [ ] 最高分记录（JSON持久化）
- [ ] Kids 音乐风格实现

### 中优先级
- [ ] Snake 和 Food 使用主题颜色（需要重构 draw 方法）
- [ ] 更多道具（磁铁、缩小身体）
- [ ] 粒子系统统一管理

### 低优先级
- [ ] UI渲染模块拆分
- [ ] 音效生成器重构
- [ ] 游戏状态管理器

---

**版本**：v2.0
**更新日期**：2026-01-18
**测试状态**：✅ 全部通过
